{% extends "layout.html" %}
{% block title %}Warden Dashboard{% endblock %}
{% block content %}
<nav class="navbar">
    <div class="nav-container">
        <a class="nav-brand" href="{{ url_for('warden_dashboard') }}">
            Warden Dashboard
            {% if new_count > 0 %}
                <span class="notification-badge">{{ new_count }}</span>
            {% endif %}
        </a>
        <ul class="nav-links">
            <li><a href="{{ url_for('warden_analytics') }}">üìà Analytics</a></li>
            <li><a href="{{ url_for('warden_profile') }}">üë§ Profile</a></li>
            <li><a href="{{ url_for('logout') }}">üö™ Logout</a></li>
        </ul>
    </div>
</nav>

<div class="container" style="max-width: 95%; margin: auto;">
    <h2 style="margin-bottom: 20px;">All Student Complaints</h2>
    
    <div style="overflow-x: auto;">
        <table class="complaint-table" style="width: 100%; border-collapse: collapse; border-radius: 10px; overflow: hidden;">
            <thead style="background-color: #f4f7fb;">
                <tr>
                    <th>Student</th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Proof</th>
                    <th>Status</th>
                    <th>Warden's Remark</th>
                </tr>
            </thead>
            <tbody>
                {% for complaint in complaints %}
                    <tr class="anim-row" style="background: white; border-bottom: 1px solid #eee;">
                        <td>{{ complaint.student_name }}</td>
                        <td>{{ complaint.title }}</td>
                        <td>{{ complaint.category }}</td>
                        <td style="max-width: 200px; word-wrap: break-word;">{{ complaint.description }}</td>
                        
                        <!-- PROOF BUTTONS (Improved Design) -->
                        <td style="text-align: center;">
                            {% if complaint.proof_file %}
                                {% set ext = complaint.proof_file.split('.')[-1].lower() %}
                                
                                {% if ext in ['png', 'jpg', 'jpeg', 'gif'] %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" 
                                       target="_blank" class="proof-btn img-btn">üñºÔ∏è View Image</a>
                                
                                {% elif ext in ['mp4', 'mov'] %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" 
                                       target="_blank" class="proof-btn video-btn">üé• Watch Video</a>

                                {% elif ext in ['mp3', 'wav'] %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" 
                                       target="_blank" class="proof-btn audio-btn">üéß Play Audio</a>
                                
                                {% else %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" 
                                       target="_blank" class="proof-btn doc-btn">üìÑ View File</a>
                                {% endif %}
                            {% else %}
                                <span style="color:#999;">N/A</span>
                            {% endif %}
                        </td>

                        <!-- STATUS -->
                        <td>
                            <form action="{{ url_for('update_status', id=complaint.id) }}" method="POST">
                                <select name="status" onchange="this.form.submit()" 
                                        style="padding:6px; border-radius:6px; border:1px solid #ccc;">
                                    <option value="Pending" {% if complaint.status == 'Pending' %}selected{% endif %}>üü° Pending</option>
                                    <option value="In Progress" {% if complaint.status == 'In Progress' %}selected{% endif %}>üü† In Progress</option>
                                    <option value="Resolved" {% if complaint.status == 'Resolved' %}selected{% endif %}>üü¢ Resolved</option>
                                </select>
                            </form>
                        </td>

                        <!-- REMARK -->
                        <td style="min-width: 200px;">
                            <form action="{{ url_for('add_remark', id=complaint.id) }}" method="POST" class="remark-form" style="display: flex; flex-direction: column; gap: 6px;">
                                <textarea name="remark" rows="2" placeholder="Add a remark..." 
                                          style="width: 100%; padding:6px; border-radius:6px; border:1px solid #ccc;">{{ complaint.remark or '' }}</textarea>
                                <button type="submit" class="btn btn-secondary btn-small" 
                                        style="align-self: flex-start; padding: 4px 10px; border-radius:6px;">Save</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- ================= STYLES ================= -->
<style>
    .complaint-table th, .complaint-table td {
        padding: 10px 15px;
        text-align: left;
        vertical-align: top;
    }
    .complaint-table th {
        font-weight: 600;
        color: #333;
    }
    .complaint-table tr:hover {
        background-color: #f9fafc;
    }

    /* Proof Buttons */
    .proof-btn {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        text-decoration: none;
        color: white;
        transition: all 0.2s ease;
    }
    .proof-btn:hover {
        opacity: 0.9;
        transform: scale(1.05);
    }
    .img-btn  { background-color: #3498db; }  /* Blue - Image */
    .video-btn{ background-color: #e67e22; }  /* Orange - Video */
    .audio-btn{ background-color: #9b59b6; }  /* Purple - Audio */
    .doc-btn  { background-color: #16a085; }  /* Teal - Other File */
</style>
{% endblock %}
